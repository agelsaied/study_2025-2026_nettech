---
title: "Отчёт по лабораторной работе 7"
subtitle: "Адресация IPv4 и IPv6. Настройка DHCP"
author: "Элсаиед Адел"

lang: ru-RU
toc-title: "Содержание"

bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt

polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english

babel-lang: russian
babel-otherlangs: english

mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math

mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9

biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric

figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"

indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получение навыков настройки службы DHCP на сетевом оборудовании для распределения адресов IPv4 и IPv6.

# Выполнение работы

## Настройка DHCP-сервиса для IPv4 на маршрутизаторе VyOS

1. В среде моделирования **GNS3** был создан новый проект и развернута топология сети, включающая персональный компьютер **PC1**, коммутатор **elsaiedadel-sw-01** и маршрутизатор **elsaiedadel-gw-01**. Соединение устройств выполнено в соответствии с заданной схемой.

   ![Топология моделируемой сети](Screenshot_1.png){ #fig:101 width=80% }

2. На маршрутизаторе VyOS выполнен вход под учётной записью по умолчанию, после чего была произведена установка системы на виртуальный диск. По завершении процесса установки маршрутизатор был перезагружен для применения изменений.

3. После перезагрузки выполнен вход в систему и переход в режим конфигурирования. В ходе настройки были заданы имя устройства `elsaiedadel-gw-01` и доменное имя `elsaiedadel.net`. Также был создан новый пользователь `elsaiedadel` с правами администратора. Конфигурация была сохранена, после чего системный пользователь, заданный по умолчанию, был удалён.

   ![Настройка имени устройства, доменного имени и пользователя](Screenshot_2.png){ #fig:102 width=80% }

4. В режиме конфигурирования выполнена настройка IPv4-адресации интерфейса `eth0` маршрутизатора. Интерфейсу был назначен статический адрес `10.0.0.1/24`, который используется в качестве шлюза по умолчанию для локальной сети.

   ![Назначение IPv4-адреса интерфейсу eth0](Screenshot_3.png){ #fig:103 width=80% }

5. На маршрутизаторе выполнена настройка DHCP-сервиса. Создана разделяемая сеть с именем `elsaiedadel`, для которой указано доменное имя `elsaiedadel.net` и адрес DNS-сервера `10.0.0.1`. Для подсети `10.0.0.0/24` задан шлюз по умолчанию `10.0.0.1`.

6. В рамках указанной подсети определён диапазон адресов, выдаваемых DHCP-сервером. Диапазон включает адреса от `10.0.0.2` до `10.0.0.253`. После завершения настройки конфигурация была применена и сохранена.

   ![Настройка DHCP-сервера и диапазона адресов](Screenshot_4.png){ #fig:104 width=80% }

7. Для контроля работы DHCP-сервиса на маршрутизаторе выполнен просмотр статистики сервера. В результате подтверждено наличие активного пула адресов и отсутствие ошибок в работе службы.

   ![Статистика DHCP-сервера](Screenshot_5.png){ #fig:105 width=80% }

8. На оконечном устройстве **PC1** выполнена настройка автоматического получения сетевых параметров по протоколу DHCP. В процессе получения адреса был отображён детализированный вывод обмена DHCP-сообщениями. Клиенту был назначен IPv4-адрес `10.0.0.2/24`, шлюз по умолчанию `10.0.0.1` и DNS-сервер `10.0.0.1`.

   ![Получение IPv4-адреса по DHCP на PC1](Screenshot_6.png){ #fig:106 width=80% }

   В процессе работы DHCP были зафиксированы стандартные этапы обмена: отправка широковещательного запроса **DHCP Discover**, получение предложения **DHCP Offer**, подтверждение выбора адреса сообщением **DHCP Request** и окончательное закрепление адреса ответом **DHCP ACK**.

9. На устройстве PC1 выполнена проверка текущей сетевой конфигурации. Также произведена проверка сетевой связности путём отправки ICMP-запросов на адрес маршрутизатора. Ответы были получены без потерь, что подтверждает корректную настройку сети.

   ![Проверка сетевых параметров и доступности шлюза](Screenshot_7.png){ #fig:107 width=80% }

10. На маршрутизаторе повторно просмотрена информация о выданных DHCP-адресах. В таблице аренд отображён активный адрес `10.0.0.2`, сопоставленный с MAC-адресом клиентского устройства, а также указаны параметры времени начала и окончания аренды.

11. Выполнен анализ журнала работы DHCP-сервера. В системных логах зафиксированы события, соответствующие обработке запросов DHCP-клиента, включая сообщения **DHCPDISCOVER**, **DHCPOFFER**, **DHCPREQUEST** и **DHCPACK**, что свидетельствует о штатной работе сервиса.

   ![Журнал работы DHCP-сервера](Screenshot_8.png){ #fig:108 width=80% }

12. С использованием анализатора трафика выполнено исследование сетевых пакетов, относящихся к работе DHCP. В захваченном трафике подтверждено использование протокола UDP и портов 67 и 68, широковещательная передача клиентских запросов и корректное заполнение DHCP-опций, включая тип сообщения, идентификатор сервера, параметры сети и назначаемый IP-адрес.

## Настройка DHCPv6 в сети IPv6

1. В ранее созданном проекте GNS3 рабочее пространство было дополнено устройствами и соединениями согласно заданной топологии: маршрутизатор **elsaiedadel-gw-01** подключён к трём коммутаторам (**elsaiedadel-sw-01**, **elsaiedadel-sw-02**, **elsaiedadel-sw-03**), к которым подключены узлы **PC1-elsaiedadel**, **PC2-elsaiedadel** и **PC3-elsaiedadel**. На линиях связи между маршрутизатором и коммутаторами для сегментов PC2 и PC3 был включён захват трафика для анализа DHCPv6.

   ![Топология моделируемой сети для IPv6](Screenshot_9.png){ #fig:201 width=80% }

2. На маршрутизаторе **elsaiedadel-gw-01** выполнен переход в режим конфигурирования и настроена IPv6-адресация интерфейсов:
   - интерфейсу `eth1` назначен адрес `2000::1/64`;
   - интерфейсу `eth2` назначен адрес `2001::1/64`.
   После назначения адресов выполнена проверка конфигурации интерфейсов командой просмотра списка интерфейсов.

   ![Назначение IPv6-адресов на eth1 и eth2 и проверка интерфейсов](Screenshot_10.png){ #fig:202 width=80% }

3. Для применения настроек IPv6-адресации выполнена фиксация изменений и сохранение конфигурации маршрутизатора (операции commit/save), что обеспечило постоянство настроек после перезагрузки.

4. Для сегмента, подключённого к интерфейсу `eth1`, настроен режим **DHCPv6 без отслеживания состояния (Stateless)**. Для этого включены объявления маршрутизатора (Router Advertisements, RA) с префиксом `2000::/64` и установлен флаг `other-config-flag`, означающий, что адрес узел получает по SLAAC, а «прочие параметры» (например DNS/домен поиска) могут быть получены через DHCPv6.

   ![Настройка Router Advertisements и DHCPv6 Stateless на eth1](Screenshot_11.png){ #fig:203 width=80% }

5. На маршрутизаторе добавлена конфигурация DHCPv6-сервера для stateless-сегмента: создана разделяемая сеть `elsaiedadel-stateless`, задана подсеть `2000::0/64`, а также общие опции (common-options):
   - DNS-сервер: `2000::1`;
   - домен поиска: `elsaiedadel.net`.
   После настройки выполнены операции `commit` и `save`, затем проверена итоговая конфигурация.

   ![Фрагмент итоговой конфигурации DHCPv6 и общих опций](Screenshot_12.png){ #fig:204 width=80% }

6. На узле **PC2** выполнена проверка IPv6-конфигурации интерфейса и таблицы маршрутизации. Подтверждено получение глобального адреса из префикса `2000::/64` по SLAAC, а также наличие маршрута по умолчанию через link-local адрес маршрутизатора (что соответствует работе Router Advertisements).

   ![IPv6-адресация и маршрутизация PC2 (SLAAC)](Screenshot_13.png){ #fig:205 width=80% }

7. На узле **PC2** выполнена проверка сетевой связности с маршрутизатором путём отправки ICMPv6-запросов на адрес `2000::1`. Пакеты доставлены успешно, потерь не зафиксировано.

   ![Проверка доступности маршрутизатора по IPv6 с PC2](Screenshot_14.png){ #fig:206 width=80% }

8. На узле **PC2** выполнена проверка настроек DNS через просмотр содержимого `/etc/resolv.conf`. Данный файл отражает текущие параметры DNS на клиенте, которые должны устанавливаться при получении «прочих параметров» (stateless) через DHCPv6.

   ![Проверка DNS-настроек на PC2](Screenshot_14.png){ #fig:207 width=80% }

9. Для получения DHCPv6-параметров без запроса адреса на **PC2** выполнен запрос DHCPv6 в режиме «только информация» (stateless). В выводе клиента зафиксированы сообщения, указывающие на отсутствие выдачи адреса по DHCPv6 (что соответствует stateless-режиму), при этом адресная конфигурация сохраняется за SLAAC.

   ![Запрос DHCPv6 параметров на PC2 и повторная проверка доступности](Screenshot_15.png){ #fig:208 width=80% }

10. На маршрутизаторе выполнена проверка таблицы аренд DHCPv6. В stateless-сценарии DHCPv6 не выдаёт IPv6-адреса (IA_NA/IAADDR), поэтому наличие пустого списка аренд соответствует выбранной модели конфигурирования (адрес получен по SLAAC, а DHCPv6 используется для «прочих параметров»).

   ![Проверка выданных аренд DHCPv6 на маршрутизаторе](Screenshot_16.png){ #fig:209 width=80% }

11. Выполнен анализ захваченного трафика DHCPv6. В трассе подтверждены типовые сообщения протокола:
   - **Solicit** (инициация клиентом),
   - **Advertise** (ответ сервера),
   - **Request** (запрос параметров клиентом),
   - **Reply** (ответ сервера с параметрами).
   В деталях пакетов зафиксированы идентификаторы клиента/сервера (Client Identifier / Server Identifier) и признаки обмена, при этом отсутствие выдачи адреса по DHCPv6 соответствует stateless-режиму (адрес формируется по SLAAC на основе RA).

   ![Анализ пакетов DHCPv6 в захваченном трафике](Screenshot_17.png){ #fig:210 width=80% }

12. На маршрутизаторе **elsaiedadel-gw-01** выполнена настройка DHCPv6 с отслеживанием состояния для сегмента сети, подключённого к интерфейсу `eth2`. Для этого в конфигурации объявлений маршрутизатора (Router Advertisements) на интерфейсе `eth2` установлен флаг `managed-flag`, указывающий, что узлы должны получать IPv6-адреса с использованием протокола DHCPv6 в режиме stateful.

   ![Включение managed-flag для RA на интерфейсе eth2](Screenshot_18.png){ #fig:301 width=80% }

13. На маршрутизаторе добавлена конфигурация DHCPv6-сервера для режима stateful. Создана разделяемая сеть `elsaiedadel-stateful`, для которой определена подсеть `2001::0/64`. В рамках данной подсети задан DNS-сервер `2001::1` и домен поиска `elsaiedadel.net`.

14. Для stateful-сегмента настроен диапазон IPv6-адресов, выдаваемых клиентам по DHCPv6. Диапазон включает адреса от `2001::100` до `2001::199`. После завершения настройки выполнены операции применения и сохранения конфигурации маршрутизатора.

   ![Настройка DHCPv6 Stateful и диапазона IPv6-адресов](Screenshot_19.png){ #fig:302 width=80% }

15. На маршрутизаторе выполнен просмотр таблицы аренд DHCPv6. В результате подтверждено наличие активной аренды IPv6-адреса `2001::199`, выданного клиентскому устройству, с указанием времени начала аренды, срока её действия и идентификаторов клиента (IAID/DUID).

   ![Таблица аренд DHCPv6 Stateful на маршрутизаторе](Screenshot_20.png){ #fig:303 width=80% }

16. На узле **PC3** выполнена проверка состояния сетевых интерфейсов и таблицы маршрутизации IPv6. Подтверждено получение глобального IPv6-адреса из диапазона `2001::100–2001::199`, а также наличие маршрута по умолчанию через link-local адрес маршрутизатора.

   ![IPv6-адресация и маршрутизация PC3](Screenshot_21.png){ #fig:304 width=80% }

17. На узле **PC3** проверены настройки DNS путём анализа содержимого файла `/etc/resolv.conf`. В конфигурации указан DNS-сервер `2001::1` и домен поиска `elsaiedadel.net`, полученные от DHCPv6-сервера в режиме stateful.

   ![DNS-настройки на PC3](Screenshot_22.png){ #fig:305 width=80% }

18. Для подтверждения сетевой связности с маршрутизатором на узле **PC3** выполнена проверка доступности IPv6-адреса `2001::1`. Ответы ICMPv6 получены без потерь, что свидетельствует о корректной настройке адресации и маршрутизации.

19. На маршрутизаторе повторно выполнен просмотр таблицы аренд DHCPv6. Подтверждено сохранение активной аренды IPv6-адреса за клиентским устройством PC3, а также корректное обновление времени аренды.

20. Выполнен анализ захваченного трафика DHCPv6 для stateful-сценария. В трассе зафиксированы последовательные сообщения **Solicit**, **Advertise**, **Request** и **Reply**, а также присутствие в ответах сервера информации об адресе (IA_NA), DNS-сервере и домене поиска. Это подтверждает корректную работу DHCPv6 в режиме отслеживания состояния и назначение IPv6-адреса клиенту по DHCPv6.

   ![Анализ пакетов DHCPv6 Stateful в захваченном трафике](Screenshot_23.png){ #fig:306 width=80% }

# Заключение

В ходе лабораторной работы была выполнена настройка DHCP для сетей IPv4 и IPv6 на маршрутизаторе VyOS. Реализованы и исследованы режимы DHCPv6 без отслеживания состояния (Stateless) и с отслеживанием состояния (Stateful). Клиентские узлы корректно получили сетевые параметры, что подтверждено проверкой адресации, маршрутизации, DNS и анализом сетевого трафика. Работа протоколов DHCP и DHCPv6 соответствует теоретической модели и требованиям задания.
